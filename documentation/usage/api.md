# Asociación de Investigacion en Inteligencia Artificial Para la Leucemia Peter Moss
# HIAS - Hospital Intelligent Automation Server
## HIASCDI - HIAS Contextual Data Interface
### HIASCDI API Usage Guide

![HIASCDI - HIAS Contextual Data Interface](../../assets/images/HIASCDI.jpg)

&nbsp;

# Table Of Contents

- [Introduction](#introduction)
- [API Documentation](#api-documentation)
	- [Overview](#overview)
	- [Secure HTTP Requests](#secure-http-requests)
	- [HTTP Responses](#http-responses)
		- [HTTP Success Response](#http-success-response)
		- [HTTP Success Codes](#http-success-codes)
		- [HTTP Error Response](#http-error-response)
		- [HTTP Error Codes](#http-error-codes)
	- [Authentication](#authentication)
	- [API Reference](#api-reference)
		- [API Entry Point](#api-entry-point)
			- [Retrieve API Resources](#retrieve-api-resources)
		- [Entities](#entities)
			- [List Entities](#list-entities)
			- [Create Entity](#create-entity)
			- [Entity by ID](#entity-by-id)
				- [Retrieve Entity](#retrieve-entity)
				- [Retrieve Entity Attributes](#retrieve-entity-attributes)
				- [Update or Append Entity Attributes](#update-or-append-entity-attributes)
				- [Replace All Entity Attributes](#replace-all-entity-attributes)
				- [Remove Entity](#remove-entity)
		- [Attributes](#attributes)
			- [Get Attribute Data](#get-attribute-data)
			- [Update Attribute Data](#update-attribute-data)
			- [Remove A Single Attribute](#remove-a-single-attribute)
		- [Attribute Value](#attributes-value)
			- [Get Attribute Value](#get-attribute-value)
			- [Update Attribute Value](#update-attribute-value)
		- [Types](#types)
- [Contributing](#contributing)
  - [Contributors](#contributors)
- [Versioning](#versioning)
- [License](#license)
- [Bugs/Issues](#bugs-issues)

&nbsp;

# Introduction

The HIASCDI Console is a REST API client for HIASCDI that is built in to the HIAS UI. The console has been designed to provide the functionalty required to interact with HIASCDI using the methods provided in the [FIWARE-NGSI v2 Specification](https://fiware.github.io/specifications/ngsiv2/stable/).

&nbsp;

# API Documentation

Version: 1.0.0

## Overview
The following is the API Documentation for the HIASCDI API. This API is based on the specifications provided in the [FIWARE-NGSI v2 Specification](https://fiware.github.io/specifications/ngsiv2/stable/).

## Secure HTTP Requests

API calls to the HIASCDI API are made using secure HTTP requests. The HIAS server protects the API endpoints with strong SSL encryption, a firewall and Basic AUTH authentication.

The following HTTP request methods are available:

- GET
- POST
- PATCH
- PUT
- DELETE

## HTTP Responses

### HTTP Success Response

- `description` (string): additional information about the response.

### HTTP Success Codes

- `200` `OK` - Request successful
- `201` `Created` - Resource created
- `204` `No Content` - Request succeeded, client doesn't need to navigate away from current page

### HTTP Error Response

The error payload is a JSON response including the following fields:

- `error` (required, string): a textual description of the error.
- `description` (optional, string): additional information about the error.

### HTTP Error Codes

- `400` `ParseError` - Incoming JSON payload cannot be parsed
- `400` `BadRequest` - Error in URL parameters or payload
- `404` `NotFound` - Resource identified by the request is not found
- `405` `MethodNotAlowed` - Requested method not supported
- `406` `NotAcceptable` - Request meme type not supported
- `409` `TooManyResults` - Request may refer to several resources
- `411` `ContentLengthRequired` - Context-Length header is required
- `413` `NoResourceAvailable` - Attemp to exceed spatial index limit results
- `413` `RequestEntityTooLarge` - Request entity too large
- `415` `UnsupportedMediaType` - Request content type not supported
- `501` `NotImplemented` - Request not supported

&nbsp;

# Authentication

Authentication is handled using the HIAS server security. Calls to HIASCDI must provide a HIAS user's key (YourKey below) in the Authorization header, authorization type **Basic**. A HIAS user's key is generated by joining the username and password with a **:** separating them, and then Base64 encoding the key.

```
headers = {
	"Content-Type": "application/json",
	"Authorization": "Basic YourKey"
}
```

&nbsp;

# API Resources

## API Entry Point

### Retrieve API Resources

This resource does not have any attributes. Instead it offers the initial API affordances in the form of the links in the JSON body.

It is recommended to follow the “url” link values, Link or Location headers where applicable to retrieve resources. Instead of constructing your own URLs, to keep your client decoupled from implementation details.

`GET` https://YourHIAS/hiascdi/v1

#### Response

| Attributes  |  |
| ------------- | ------------- |
| **entities_url**<br />required  | string<br />URL which points to the entities resource<br />`/v1/entities` |
| **types_url**<br />required  | string<br />URL which points to the types resource<br />`/v1/types` |
| **subscriptions_url**<br />required  | string<br />URL which points to the subscriptions resource<br />`/v1/subscriptions` |
| **registrations_url**<br />required  | string<br />URL which points to the registrations resource<br />`/v1/registrations` |

## Entities

### List Entities

Retrieves a list of entities that match different criteria by id, type, pattern matching (either id or type) and/or those which match a query or geographical query (see Simple Query Language and Geographical Queries). A given entity has to match all the criteria to be retrieved (i.e., the criteria is combined in a logical AND way). Note that pattern matching query parameters are incompatible (i.e. mutually exclusive) with their corresponding exact matching parameters, i.e. idPattern with id and typePattern with type.

The response payload is an array containing one object per matching entity. Each entity follows the JSON entity representation format (described in "JSON Entity Representation" section of the FIWARE NGSI-V2 specification).

`GET` https://YourHIAS/hiascdi/v1/entities?id=00000000-0000-0000-0000-000000000000000&type=Robotics&idPattern=00000000-.\*&typePattern=Room_.*&q=temperature%3E40&mq=temperature.accuracy%3C0.9&georel=near&geometry=point&coords=41.390205%2C2.154007%3B48.8566%2C2.3522&limit=20&offset=20&attrs=seatNumber&metadata=accuracy&orderBy=temperature%2C!speed&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| id | A comma-separated list of elements. Retrieve entities whose ID matches one of the elements in the list. Incompatible with idPattern.<br />_**Example:**_ `00000000-0000-0000-0000-000000000000000`. | String | &#9745; |
| type | A comma-separated list of elements. Retrieve entities whose type matches one of the elements in the list. Incompatible with typePattern.<br />_**Example:**_ `Robotics`. | String | &#9745;  |
| idPattern | A correctly formated regular expression. Retrieve entities whose ID matches the regular expression. Incompatible with **id**.<br />_**Example:**_ `00000000-.*`. | String | &#9745;  |
| typePattern | A correctly formated regular expression. Retrieve entities whose type matches the regular expression. Incompatible with **type**.<br />_**Example:**_ `Robot.*`. | String | &#9745;  |
| q | A query expression, composed of a list of statements separated by ;, i.e., q=statement1;statement2;statement3. See Simple Query Language specification.<br />_**Example:**_ `temperature>40`. | String | &#9745;  |
| mq | A query expression for attribute metadata, composed of a list of statements separated by ;, i.e., mq=statement1;statement2;statement3. See Simple Query Language specification.<br />_**Example:**_ `temperature.accuracy<0.9`. | String |   |
| georel | Spatial relationship between matching entities and a reference shape. See Geographical Queries specification.<br />_**Example:**_ `near`. | String | &#9745; |
| geometry | Geografical area to which the query is restricted. See Geographical Queries specification.<br />_**Example:**_ `point`. | String | &#9745; |
| coords | List of latitude-longitude pairs of coordinates separated by ';'. See Geographical Queries specification.<br />_**Example:**_ `41.390205,2.154007;48.8566,2.3522`. | String | &#9745; |
| limit | Limits the number of entities to be retrieved.<br />_**Example:**_ `20`. | Number | &#9745; |
| offset | Establishes the offset from where entities are retrieved.<br />_**Example:**_ `20`. | Number | &#9745; |
| metadata | A list of metadata names to include in the response. See "Filtering out attributes and metadata" section of specifications for more detail.<br />_**Example:**_ `accuracy`. | String | |
| orderBy | Criteria for ordering results. See "Ordering Results" section of specifications for details.<br />_**Example:**_ `temperature,!speed`. | String | &#9745; |
| Options | Options dictionary.<br />_**Possible values:**_ `count`, `keyValues` , `values` , `unique`. | String | |

#### Response

- Successful operation uses 200 OK
- Errors use a non-2xx and (optionally) an error payload.

## Create Entity

The payload is an object representing the entity to be created. The object follows the JSON entity representation format (described in a "JSON Entity Representation" section).

`POST` https://YourHIAS/hiascdi/v1/entities?options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| Options | Options dictionary.<br />_**Possible values:**_ `keyValues`, `upsert`. | String | |

#### Response:

- Successful operation uses 201 Created (if upsert option is not used) or 204 No Content (if upsert option is used). Response includes a Location header with the URL of the created entity.

- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

## Entity by ID

### Retrieve Entity

The response is an object representing the entity identified by the ID. The object follows the JSON entity representation format (described in "JSON Entity Representation" section).

This operation must return one entity element only, but there may be more than one entity with the same ID (e.g. entities with same ID but different types). In such case, an error message is returned, with the HTTP status code set to 409 Conflict.

`GET` https://YourHIAS/hiascdi/v1/entityId?type=&attrs=temperature%2Chumidity&metadata=accuracy&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity to be retrieved. **(REQUIRED)** | String | &#9745; |
| type | Comma-separated list of attribute names whose data must be included in the response. The attributes are retrieved in the order specified by this parameter. See "Filtering out attributes and metadata" section for more detail. If this parameter is not included, the attributes are retrieved in arbitrary order, and all the attributes of the entity are included in the response.<br />_**Example:**_ `temperature,humidity` | String | &#9745; |
| metadata | A list of metadata names to include in the response. See "Filtering out attributes and metadata" section for more detail.<br />_**Example:**_ `accuracy` | String | |
| Options | Options dictionary.<br />_**Possible values:**_ `keyValues`, `value`, `unique`. | String | |

#### Response:

- Successful operation uses 200 OK

- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

### Retrieve Entity Attributes

This request is similar to retreiving the whole entity, however this one omits the id and type fields.

Just like the general request of getting an entire entity, this operation must return only one entity element. If more than one entity with the same ID is found (e.g. entities with same ID but different type), an error message is returned, with the HTTP status code set to 409 Conflict.

`GET` https://YourHIAS/hiascdi/v1/entityId/attrs?type=&attrs=temperature%2Chumidity&metadata=accuracy&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity to be retrieved. **(REQUIRED)** | String | &#9745; |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | &#9745; |
| attrs | Comma-separated list of attribute names whose data are to be included in the response. The attributes are retrieved in the order specified by this parameter. If this parameter is not included, the attributes are retrieved in arbitrary order, and all the attributes of the entity are included in the response. See "Filtering out attributes and metadata" section for more detail.<br />_**Example:**_ `temperature,humidity` | String | &#9745; |
| metadata | A list of metadata names to include in the response. See "Filtering out attributes and metadata" section for more detail.<br />_**Example:**_ `accuracy` | String | |
| Options | Options dictionary.<br />_**Possible values:**_ `keyValues`, `value`, `unique`. | String | |

#### Response:

- Successful operation uses 200 OK
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

### Update or Append Entity Attributes

The request payload is an object representing the attributes to append or update. The object follows the JSON entity representation format (described in "JSON Entity Representation" section), except that id and type are not allowed.

The entity attributes are updated with the ones in the payload, depending on whether the append operation option is used or not.

- If append is not used: the entity attributes are updated (if they previously exist) or appended (if they don't previously exist) with the ones in the payload.
- If append is used (i.e. strict append semantics): all the attributes in the payload not previously existing in the entity are appended. In addition to that, in case some of the attributes in the payload already exist in the entity, an error is returned.

`POST` https://YourHIAS/hiascdi/v1/entityId/attrs?type=&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity to be updated. **(REQUIRED)** | String | &#9745; |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | &#9745; |
| Options | Options dictionary.<br />_**Possible values:**_ `keyValues`, `append`. | String | |

#### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

### Update Existing Entity Attributes

The entity attributes are updated with the ones in the payload. In addition to that, if one or more attributes in the payload doesn't exist in the entity, an error is returned.

`PATCH` https://YourHIAS/hiascdi/v1/entityId/attrs?type=&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity to be updated. **(REQUIRED)** | String | &#9745; |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | &#9745; |
| Options | Options dictionary.<br />_**Possible values:**_ `keyValues`. | String | |

#### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

### Replace All Entity Attributes

The request payload is an object representing the new entity attributes. The object follows the JSON entity representation format (described in a "JSON Entity Representation" above), except that id and type are not allowed.

The attributes previously existing in the entity are removed and replaced by the ones in the request.

`PUT` https://YourHIAS/hiascdi/v1/entityId/attrs?type=&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity to be updated. **(REQUIRED)** | String | &#9745; |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | &#9745; |
| Options | Options dictionary.<br />_**Possible values:**_ `keyValues`. | String | |

#### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

### Remove Entity

Delete the entity.

`DELETE` https://YourHIAS/hiascdi/v1/entityId?type=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity to be updated. **(REQUIRED)** | String | &#9745; |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | &#9745; |

#### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

## Attributes

### Attribute by Entity ID

#### Get Attribute Data

Returns a JSON object with the attribute data of the attribute. The object follows the JSON representation for attributes (described in "JSON Attribute Representation" section).

`GET` https://YourHIAS/hiascdi/v1/entityId/attrs/attrName?type=&metadata=accuracy

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity. **(REQUIRED)** | String | |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | |
| attrName | Name of the attribute to be retrieved. **(REQUIRED)** | String | |
| metadata | A list of metadata names to include in the response. See "Filtering out attributes and metadata" section for more detail.<br />_**Example:**_ `accuracy` | String | |

##### Response:

- Successful operation uses 200 OK.
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

#### Update Attribute Data

The request payload is an object representing the new attribute data. Previous attribute data is replaced by the one in the request. The object follows the JSON representation for attributes (described in "JSON Attribute Representation" section).

`PUT` https://YourHIAS/hiascdi/v1/entityId/attrs/attrName?type=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity. **(REQUIRED)** | String | |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | |
| attrName | Name of the attribute to be retrieved. **(REQUIRED)** | String | |

##### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

#### Remove A Single Attribute

Removes an entity attribute.

`DELETE` https://YourHIAS/hiascdi/v1/entityId/attrs/attrName?type=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity. **(REQUIRED)** | String | |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | |
| attrName | Name of the attribute to be retrieved. **(REQUIRED)** | String | |

##### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

## Attribute Value

### By Entity ID

#### Get Attribute Value

This operation returns the value property with the value of the attribute.

- If attribute value is JSON Array or Object:

	- If Accept header can be expanded to application/json or text/plain return the value as a JSON with a response type of application/json or text/plain (whichever is the first in Accept header or application/json in case of Accept: */*).

	- Else return a HTTP error "406 Not Acceptable: accepted MIME types: application/json, text/plain"

- If attribute value is a string, number, null or boolean:

	- If Accept header can be expanded to text/plain return the value as text. In case of a string, citation marks are used at the begining and end.

	- Else return a HTTP error "406 Not Acceptable: accepted MIME types: text/plain"

`GET` https://YourHIAS/hiascdi/v1/entityId/attrs/attrName/value?type=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity. **(REQUIRED)** | String | |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | |
| attrName | Name of the attribute to be retrieved. **(REQUIRED)** | String | |

##### Response:

- Successful operation uses 200 OK.
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

#### Update Attribute Value

The request payload is the new attribute value.

- If the request payload MIME type is application/json, then the value of the attribute is set to the JSON object or array coded in the payload (if the payload is not a valid JSON document, then an error is returned).

- If the request payload MIME type is text/plain, then the following algorithm is applied to the payload:

	- If the payload starts and ends with citation-marks ("), the value is taken as a string (the citation marks themselves are not considered part of the string)If true or false, the value is taken as a boolean.
	- If null, the value is taken as null.
	- If these first three tests 'fail', the text is interpreted as a number.
	- If not a valid number, then an error is returned and the attribute's value is unchanged.

The payload MIME type in the request is specified in the Content-Type HTTP header.

`PUT` https://YourHIAS/hiascdi/v1/entityId/attrs/attrName/value?type=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityId | Id of the entity. **(REQUIRED)** | String | |
| type | Entity type, to avoid ambiguity in case there are several entities with the same entity id. | String | |
| attrName | Name of the attribute to be retrieved. **(REQUIRED)** | String | |

##### Response:

- Successful operation uses 204 No Content
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

## Types

### Entity types

#### List Entity Types

If the values option is not in use, this operation returns a JSON array with the entity types. Each element is a JSON object with information about the type:

- type : the entity type name.
- attrs : the set of attribute names along with all the entities of such type, represented in a JSON object whose keys are the attribute names and whose values contain information of such attributes (in particular a list of the types used by attributes with that name along with all the entities).
- count : the number of entities belonging to that type.

If the values option is used, the operation returns a JSON array with a list of entity type names as strings.

Results are ordered by entity type in alphabetical order.

`GET` https://YourHIAS/hiascdi/v1/types/?limit=10&offset=20&options=

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| limit | Limit the number of types to be retrieved.<br />_**Example:**_ `10` | Number | |
| offset | Skip a number of records.<br />_**Example:**_ `20` | Number | |
| Options | Options dictionary.<br />_**Possible values:**_ `count`, `values`. | String | |

##### Response code:

- Successful operation uses 200 OK
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

### Entity Type

#### Retrieve Entity Type

This operation returns a JSON object with information about the type:

- attrs : the set of attribute names along with all the entities of such type, represented in a JSON object whose keys are the attribute names and whose values contain information of such attributes (in particular a list of the types used by attributes with that name along with all the entities).

- count : the number of entities belonging to that type.

`GET` https://YourHIAS/hiascdi/v1/types/entityType

| Parameters  |  |  | Compliant |
| ------------- | ------------- | ------------- | ------------- |
| entityType | Entity Type.<br />_**Example:**_ `Robot` | String | |

##### Response code:

- Successful operation uses 200 OK
- Errors use a non-2xx and (optionally) an error payload. See subsection on "Error Responses" for more details.

&nbsp;

# Contributing

The Peter Moss Acute Myeloid & Lymphoblastic Leukemia AI Research project encourages and youlcomes code contributions, bug fixes and enhancements from the Github.

Please read the [CONTRIBUTING](../CONTRIBUTING.md "CONTRIBUTING") document for a full guide to forking our repositories and submitting your pull requests. You will also find information about our code of conduct on this page.

## Contributors

- [Adam Milton-Barker](https://www.leukemiaresearchassociation.ai/team/adam-milton-barker "Adam Milton-Barker") - [Asociacion De Investigacion En Inteligencia Artificial Para La Leucemia Peter Moss](https://www.leukemiaresearchassociation.ai "Asociacion De Investigacion En Inteligencia Artificial Para La Leucemia Peter Moss") President/Founder & Lead Developer, Sabadell, Spain

&nbsp;

# Versioning

You use SemVer for versioning. For the versions available, see [Releases](../releases "Releases").

&nbsp;

# License

This project is licensed under the **MIT License** - see the [LICENSE](../LICENSE "LICENSE") file for details.

&nbsp;

# Bugs/Issues

You use the [repo issues](../issues "repo issues") to track bugs and general requests related to using this project. See [CONTRIBUTING](../CONTRIBUTING.md "CONTRIBUTING") for more info on how to submit bugs, feature requests and proposals.